<?php include_once (__DIR__ . "/../../_pay/stripe/stripe-php-7.57.0/init.php");class PayStripe extends Pay {    public static $system = "stripe";    public static function before()    {        $urlMain = Common::urlSiteSubfolders();        $returnCancel = $urlMain;        $requestUri = Pay::getRequestUri();        if ($requestUri != "") {            $returnCancel = $requestUri;        }        $order = self::createOrder();        // $publicKey = 'pk_test_51RPNwmSIRj4XxjZLd4zSRgMNo2IrebfQdDueFGvuNzFjYEgTC2RcaF85RMgVf1mvK52aZrVh0qO08CNL89tq0SlH00uUWh5nsq';        // $secretKey = 'sk_test_51RPNwmSIRj4XxjZLZjUH1EI9GagoJhdZWPk904eH5U2783DHJU8VAh8SNVoi0l4XpBQ1m9TcK4MULrj5CB0hO3Sm00flRRx6gz';        $publicKey =            "pk_live_51OWjtGSAZRM4p7T3ZRt8GbqPfLm8AO9BcdaymYgTQsiWQGu39P5I41bon0kEj3J0XSnOwYXRpOGGbanN6gW6Te8d00CAdGjahp";        $secretKey =            "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";        \Stripe\Stripe::setApiKey($secretKey);        //$arr_stripe_line_items['payment_intent_data']['metadata']['order_id'] = $order;        $session = \Stripe\Checkout\Session::create([            "payment_method_types" => "card",            "line_items" => [                [                    "price_data" => [                        "currency" => "EUR",                        "product_data" => [                            "name" => self::getPlanField("item_name"),                        ],                        "unit_amount" =>                            floatval(self::getPlanField("amount")) * 100,                    ],                    "quantity" => 1,                ],            ],            "mode" => "payment",            "success_url" => self::callbackUrl(["client_return_action" => 1]),            "cancel_url" => $returnCancel,            "metadata" => ["order_id" => $order],        ]);        if ($session) {            $publicKeyEscaped = htmlspecialchars(                $publicKey,                ENT_QUOTES,                "UTF-8"            );            $sessionIdEscaped = json_encode($session->id);            $returnCancelEscaped = json_encode($returnCancel);?>            <script src='https://js.stripe.com/v3/'></script>            <script>                var publicKeyEscaped = '<?php echo $publicKeyEscaped; ?>';                var sessionIdEscaped = '<?php echo $sessionIdEscaped; ?>';                var returnCancelEscaped = '<?php echo $returnCancelEscaped; ?>';                var stripe = Stripe(publicKeyEscaped);                stripe.redirectToCheckout({ sessionId: sessionIdEscaped })                    .then(function (result) {                        if (result.error) {                            alert(result.error.message);                            window.location.href = returnCancelEscaped;                        }                    })                    .catch(function (error) {                        console.error('Stripe Error:', error);                        alert('An unexpected error occurred.');                        window.location.href = returnCancelEscaped;                    });            </script>            <?php        }    }}